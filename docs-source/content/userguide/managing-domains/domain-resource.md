+++
title = "Domain resource"
date = 2019-02-23T16:43:45-05:00
weight = 2
pre = "<b> </b>"
+++




Use this document to set up and configure your own [domain resource](https://github.com/oracle/weblogic-kubernetes-operator/blob/master/docs/domains/Domain.md) which can be used to configure the operation of your WebLogic domain. The domain resource does not replace the traditional configuration of WebLogic domains found in the domain configuration files, but instead cooperates with those files to describe the Kubernetes artifacts of the corresponding domain.  For instance, the WebLogic domain configuration will still specify deployed applications, data sources and most other details about the domain while the domain resource will specify the number of cluster members currently running or the persistent volumes that will be mounted into the containers running WebLogic Server instances.

Many of the samples accompanying the operator project include scripts to generate an initial domain resource from a set of simplified inputs; however, the domain resource is the actual source of truth for how the WebLogic operator will manage each WebLogic domain.  You are encouraged to either start with the domain resource YAML files generated by the various samples or create domain resources manually or using other tools based on the schema referenced here or this documentation.

Swagger documentation is available [here](https://oracle.github.io/weblogic-kubernetes-operator/swagger/index.html).

#### Prerequisites

The following prerequisites must be fulfilled before proceeding with the creation of the resource:

* Make sure the WebLogic operator is running.
* Create a Kubernetes namespace for the domain resource unless the intention is to use the default namespace.
* Create the Kubernetes secrets `username` and `password` of the administrative account in the same Kubernetes namespace as the domain resource.

#### YAML files

Domain resources are defined using the domain resource YAML files. For each WLS domain you want to create and configure, you should create one domain resource YAML file and apply it. In the example referenced below, the sample script, `create-domain.sh`, generates a domain resource YAML file that you can use as a basis. Copy the file and override the default settings so that it matches all the WLS domain parameters that define your WLS domain.

See the [WebLogic sample domain home on a persistent volume README]({{< relref "/samples/simple/domains/domain-home-on-pv/_index.md" >}}).

#### Kubernetes resources

After you have written your YAML files, you use them to create your WLS domain artifacts using the `kubectl apply -f` command.

```
$ kubectl apply -f domain-resource.yaml
```

#### Verify the results

To confirm that the domain resource was created, use this command:

```
$ kubectl describe domain [domain name] -n [namespace]
```

#### Domain resource overview

The domain resource, like all [Kubernetes objects](https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/), is described by three sections: `metadata`, `spec`, and `status`.  

The `metadata` section names the domain resource and its namespace.  The name of the domain resource is the default value for the "domain UID" which is used by the operator to distinguish domains running in the Kubernetes cluster that may have the same domain name.  The domain resource name is required to be unique in the namespace and the domain UID should be unique across the cluster.  The domain UID, domain resource name and domain name (from the WebLogic domain configuration) may all be different.

The `spec` section describes the intended running state of the domain, including intended runtime state of server instances, number of cluster members started, and details about Kubernetes pod or service generation, such as resource constraints, scheduling requirements, or volume mounts.

The `status` section is updated by the operator and describes the actual running state of the domain, including WebLogic Server instance runtime states and current health.

#### Domain resource spec elements

The domain resource `spec` section contains elements for configuring the domain operation and sub-sections specific to the admin server, specific clusters or specific managed servers.

Elements related to domain identification, Docker image and domain home:
* `domainUID`: Domain unique identifier. Must be unique across the Kubernetes cluster. Not required. Defaults to the value of `metadata.name`.
* `image`: The WebLogic Docker image. Required when `domainHomeInImage` is true; otherwise, defaults to "container-registry.oracle.com/middleware/weblogic:12.2.1.3".
* `imagePullPolicy`: The image pull policy for the WebLogic Docker image. Legal values are `Always`, `Never` and `IfNotPresent`. Defaults to `Always` if image ends in ":latest", `IfNotPresent` otherwise.
* `imagePullSecrets`: A list of image pull secrets for the WebLogic Docker image.
* `domainHome`: The folder for the WebLogic Domain. Not required. Defaults to "/shared/domains/domains/domainUID" if `domainHomeInImage` is false Defaults to "/u01/oracle/user_projects/domains/" if `domainHomeInImage` is true
* `domainHomeInImage`: True if this domain's home is defined in the docker image for the domain. Defaults to true.

Elements related to logging:
* `includeServerOutInPodLog`: If true (the default), the server ".out" file will be included in the pod's stdout.
* `logHome`: The in-pod name of the directory in which to store the domain, node manager, server logs, and server ".out" files.
* `logHomeEnabled`: Specifies whether the log home folder is enabled. Not required. Defaults to true if `domainHomeInImage` is false. Defaults to false if `domainHomeInImage` is true.

Elements related to security:
* `webLogicCredentialsSecret`: The name of a pre-created Kubernetes secret, in the domain resource's namespace, that holds the username and password needed to boot WebLogic Server under the 'username' and 'password' fields.

Elements related to domain [startup and lifecycle](domain-lifecycle/startup.md):
* `serverStartPolicy`: The strategy for deciding whether to start a server. Legal values are `ADMIN_ONLY`, `NEVER`, or `IF_NEEDED`.
* `serverStartState`: The state in which the server is to be started. Use `ADMIN` if server should start in the admin state. Defaults to `RUNNING`.
* `restartVersion`: If present, every time this value is updated the operator will restart the required servers.
* `replicas`: The number of managed servers to run in any cluster that does not specify a `replicas` count.

Elements related to overriding WebLogic domain configuration:
* `configOverrides`: The name of the config map for optional WebLogic configuration overrides.
* `configOverrideSecrets`: A list of names of the secrets for optional WebLogic configuration overrides.

Elements related to Kubernetes pod and service generation:
* `serverPod`: Configuration affecting server pods.
* `serverService`: Customization affecting ClusterIP Kubernetes services for WebLogic server instances.

Sub-sections related to the administration server, specific clusters or specific managed servers:
* `adminServer`: Configuration for the administration server.
* `clusters`: Configuration for specific clusters.
* `managedServers`: Configuration for specific managed servers.

The elements `serverStartPolicy`, `serverStartState`, `serverPod` and `serverService` are repeated under `adminServer` and under each entry of `clusters` or `managedServers`.  The values directly under `spec` set the defaults for the entire domain.  The values under a specific entry under `clusters` set the defaults for cluster members of that cluster.  The values under `adminServer` or an entry under `managedServers` set the values for that specific server.  Values from the domain scope and values from the cluster (for cluster members) are merged with or overridden by the setting for the specific server depending on the element.  See the [startup and lifecycle](domain-lifecycle/startup.md) documentation for details about `serverStartPolicy` combination.

### Pod generation

The operator creates a pod for each running WebLogic server instance.  This pod will have a container based on the Docker image specified by the `image` field.  Additional pod or container content can be specified using the elements under `serverPod`.  This includes Kubernetes labels and annotations, additional volumes on the pod or volume mounts on the container, [resource requirements](https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/) or [security context](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/).

Prior to creating a pod, the operator replaces variable references allowing the pod content to be templates.  The format of these variable references is `$(VARIABLE_NAME)` where *VARIABLE_NAME* is one of the variable names available in the container for the WebLogic server instance.  The default set of environment variables includes:
* DOMAIN_NAME: The WebLogic domain name
* DOMAIN_UID: The domain unique identifier
* DOMAIN_HOME: The domain home location as a file system path within the container
* SERVER_NAME: The WebLogic server name
* CLUSTER_NAME: The WebLogic cluster name, if this is a cluster member
* LOG_HOME: The WebLogic log location as a file system path within the container
