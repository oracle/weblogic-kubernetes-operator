# Copyright 2018 Oracle Corporation and/or its affiliates.  All rights reserved.
# Licensed under the Universal Permissive License v 1.0 as shown at http://oss.oracle.com/licenses/upl.

# When the customer installs the weblogic operator helm chart, the customer can set
# elkIntegrationEnabled to true in their values.yaml to tell the operator to send the
# contents of the operator's log to elasticsearch.
#
# Typically, a customer would have already configured elasticsearch and kibana in the
# Kubernetes cluster, and also would specify elasticSearchHost and elasticSearchPort
# in their values.yaml file to point to where elasticsearch is already running.
#
# This sample configures the elasticsearch and kibana deployments and services.
# It's useful for trying out the operator in a Kubernetes cluster that doesn't already
# have them configured.
#
# It runs elasticstack on the same host and port that the operator's helm chart defaults
# to, therefore, the customer only needs to set elkIntegrationEnabled to true in their
# values.yaml file.
#
# To configure them, use:
#   kubectl apply -f kubernetes/samples/scripts/elasticsearch_and_kibana.yaml
#
# To remove them, use:
#   kubectl apply -f kubernetes/samples/scripts/elasticsearch_and_kibana.yaml

---
apiVersion: apps/v1beta1
kind: Deployment
metadata:
  namespace: "default"
  name: "elasticsearch"
  labels:
    app: "elasticsearch"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: "elasticsearch"
  template:
    metadata:
      labels:
        app: "elasticsearch"
    spec:
      containers:
      - name: "elasticsearch"
        image: "elasticsearch:5"
        ports:
        - containerPort: 9200
        - containerPort: 9300

---
kind: "Service"
apiVersion: "v1"
metadata:
  namespace: "default"
  name: "elasticsearch"
spec:
  ports:
  - name: "http"
    protocol: "TCP"
    port: 9200
    targetPort: 9200
  - name: "https"
    protocol: "TCP"
    port: 9300
    targetPort: 9300
  selector:
    app: "elasticsearch"

---
apiVersion: "apps/v1beta1"
kind: "Deployment"
metadata:
  namespace: "default"
  name: "kibana"
  labels:
    app: "kibana"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: "kibana"
  template:
    metadata:
      labels:
        app: "kibana"
    spec:
      containers:
      - name: "kibana"
        image: "kibana:5"
        ports:
        - containerPort: 5601

---
apiVersion: "v1"
kind: "Service"
metadata: 
  namespace: "default"
  name: "kibana"
  labels: 
    app: "kibana"
spec: 
  type: "NodePort"
  ports:
    - port: 5601
  selector: 
    app: "kibana"
