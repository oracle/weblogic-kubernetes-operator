# Quick start guide

Use this quick start guide to create a WebLogic deployment in a Kubernetes cluster with the Oracle WebLogic Kubernetes Operator. Please note that this walk-through is for demonstration purposes only, not for use in production.

## Prerequisite
For this exercise, youâ€™ll need a Kubernetes cluster. If you need help setting one up, check out our [cheat sheet](k8s_setup.md).

## 1.	Get these images and put them into your local registry.

a.	Pull the operator image:
```
$ docker pull oracle/weblogic-kubernetes-operator:2.0
```
b.	Pull the Traefik load balancer image:
```
$ docker pull traefik:latest
```
c.	Pull the WebLogic 12.2.1.3 install image:
```
$ docker pull store/oracle/weblogic:12.2.1.3
```

## 2. Create a Traefik (Ingress-based) load balancer.

Use Helm to install the [Traefik](../kubernetes/samples/charts/traefik/README.md) load balancer.
```
$ helm install --name traefik-operator --namespace traefik stable/traefik
```
## 3. Install the operator.

a.  Create a namespace for the operator:
```
$ kubectl create namespace sample-weblogic-operator-ns
```
b.	Create a service account for the operator in the operator's namespace:
```
$ kubectl create serviceaccount -n sample-weblogic-operator-ns sample-weblogic-operator-sa
```
c.  Use ` helm` to install and start the operator:	 

```
$ helm install \
  --name sample-weblogic-operator \
  --namespace sample-weblogic-operator-ns \
  --set serviceAccount=sample-weblogic-operator-sa \
  --set "domainNamespaces={}" \
  -- wait \
  kubernetes/charts/weblogic-operator
```
d.  Verify that the operator is up and running by viewing the operator pod's log:

```
$ kubectl log -n sample-weblogic-operator-ns -c weblogic-operator deployments/weblogic-operator
```

## 4. Prepare your environment for a domain.

a.  Create a namespace that can host one or more domains:

```
$ kubectl create namespace sample-domains-ns1
```
b.	Use `helm` to configure the operator to manage domains in this namespace:

```
$ helm upgrade \
  --reuse-values \
  --set "domainNamespaces={sample-domains-ns1}" \
  --wait \
  sample-weblogic-operator \
  kubernetes/charts/weblogic-operator

```
c.  Configure Traefik to manage Ingresses created in this namespace:
```
$ helm upgrade \
  --reuse-values \
  --set something about namespaces
```

## 5. Create a domain in the domain namespace.

a.	Create a new image with a domain home by running the [`create-domain-in-image`](../kubernetes/samples/scripts/create-weblogic-domain/domain-home-in-image/README.md) script.
* First, create a directory for the files generated by the sample.
* Then, copy the `inputs.yaml` file from the sample and modify it:
  * Specify a `domainUID`:
  * Specify the domain namespace: `sample-domains-ns1`
  * Specify the number and type of servers:

b.	The sample also creates a domain resource YAML file.
* Use `kubectl apply -f` on the YAML file to create the domain resource.
    * This tells the operator to manage the new domain.
    * The operator will notice and start up the servers in the domain.

c.	Confirm that the operator started the servers for the domain by using `kubectl`.
* Also, use `kubectl`to show that the domain resource was created.
* Look at the operator log.

d.	Create an Ingress for the domain, in the domain namespace, by using the [sample](../kubernetes/samples/charts/ingress-per-domain/README.md) Helm chart:
* Use `helm install`, specifying the `domainUID` and domain namespace.
```
$ cd kubernetes/samples/charts
$ helm install ingress-per-domain --name domain1-ingress --value values.yaml
```

e.	Confirm that the load balancer noticed the new Ingress and is successfully routing to the domain's server pods.
* Browse to the URL:


## 6. Remove the domain.

a.	Remove the domain's Ingress by using `helm`

b.	Remove the domain resource by using the sample [delete domain resources script](https://github.com/oracle/weblogic-kubernetes-operator/blob/develop/kubernetes/samples/scripts/delete-weblogic-domain-resources.sh).

c.	Use `kubectl` to confirm that the server pods and domain resource are gone.

## 7. Remove the domain namespace.
a.	Configure the Traefik load balancer to stop managing the Ingresses in the domain namespace:

```
$ helm upgrade \
  --reuse-values \
  --set something about namespaces
```

b.	Configure the operator to stop managing the domain.

```
$ helm upgrade \
  --reuse-values \
  --set "domainNamespaces={}" \
  --wait \
  sample-weblogic-operator \
  kubernetes/charts/weblogic-operator
```
c.	Delete the domain namespace:

```
$ kubectl delete namespace sample-domains-ns1
```

## 8. Remove the operator.

a.	Remove the operator:
```
helm delete --purge sample-weblogic-operator
```
b.	Remove the operator's namespace:

```
$ kubectl delete namespace sample-weblogic-operator-ns
```
## 9. Remove the load balancer.
a.	Remove the Traefik load balancer:
```
helm delete --purge traefik-operator
```
b.	Remove the Traefik namespace:

```
$ kubectl delete namespaces traefik
```
