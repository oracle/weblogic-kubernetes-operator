# Copyright 2018, Oracle Corporation and/or its affiliates. All rights reserved.
# Licensed under the Universal Permissive License v 1.0 as shown at http://oss.oracle.com/licenses/upl.

apiVersion: batch/v1
kind: Job
metadata:
  labels:
    weblogic.createdByOperator: "true"
    weblogic.domainUID: ${DOMAIN_UID}
    weblogic.resourceVersion: domain-v2
  name: ${JOB_NAME}
  namespace: ${NAMESPACE}
spec:
  backoffLimit: 0
  template:
    metadata:
    spec:
      restartPolicy: Never
      activeDeadlineSeconds: 180
      containers:
      - command:
        - ${JOB_SCRIPT}
        env:
        - name: NAMESPACE
          value: "${NAMESPACE}"
        - name: DOMAIN_UID
          value: "${DOMAIN_UID}"
        - name: DOMAIN_HOME
          value: "${DOMAIN_HOME}"
        - name: NODEMGR_HOME
          value: "${NODEMGR_HOME}"
        - name: LOG_HOME
          value: "${LOG_HOME}"
        image: "${WEBLOGIC_IMAGE_NAME}:${WEBLOGIC_IMAGE_TAG}"
        imagePullPolicy: ${WEBLOGIC_IMAGE_PULL_POLICY}
        name: weblogic-server
        volumeMounts:
        - name: weblogic-credentials-volume
          mountPath: /weblogic-operator/secrets
          readOnly: true
        - name: weblogic-domain-cm-volume
          mountPath: /weblogic-operator/scripts
          readOnly: true
        - name: test-script-cm-volume
          mountPath: /test-scripts
          readOnly: true
        ${PVCOMMENT}- mountPath: /shared
        ${PVCOMMENT}  name: weblogic-domain-storage-volume
      volumes:
      - name: weblogic-credentials-volume
        secret:
          defaultMode: 420
          secretName:  ${WEBLOGIC_CREDENTIALS_SECRET_NAME}
      - name: weblogic-domain-cm-volume
        configMap:
          defaultMode: 365
          name: weblogic-domain-cm
      - name: test-script-cm-volume
        configMap:
          defaultMode: 365
          name: test-script-cm
      ${PVCOMMENT}- name: weblogic-domain-storage-volume
      ${PVCOMMENT}  persistentVolumeClaim:
      ${PVCOMMENT}    claimName: ${DOMAIN_UID}-weblogic-domain-pvc
