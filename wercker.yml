# Copyright 2017, 2018, Oracle Corporation and/or its affiliates.  All rights reserved.
# Licensed under the Universal Permissive License v 1.0 as shown at http://oss.oracle.com/licenses/upl.

#
#  Wercker build file for Oracle WebLogic Server Kubernetes Operator
#

#
#  Wercker application is at : https://app.wercker.com/Oracle/weblogic-kubernetes-operator
#
#  Werkcer workflow looks like this:
#
#  build -> integration-tests (1.7.9)
#        -> integration-tests (1.8.5)
#        -> quality
#

box: maven:3.5.2-jdk-8

# This is the main build pipeline that builds the codebase and runs unit tests.
build:
  steps:
  - script:
    name: Hello
    code: |
      echo "Building Oracle WebLogic Server Kubernetes Operator..."
      echo "The branch and commit id are $WERCKER_GIT_BRANCH, $WERCKER_GIT_COMMIT"
  - install-packages:
      packages: tar gzip
  - java/maven:
      goals: clean install
      version: 3.5.2
      cache_repo: true
  - script:
      name: Copy built-artifacts into the image
      code: |
        mkdir /operator
        cp -R src/main/scripts/* /operator/
        cp target/weblogic-kubernetes-operator-0.1.0.jar /operator/weblogic-kubernetes-operator.jar
        export IMAGE_TAG_OPERATOR="${WERCKER_GIT_BRANCH//[_\/]/-}"
        if [ "$IMAGE_TAG_OPERATOR" = "master" ]; then
          export IMAGE_TAG_OPERATOR="latest"
        fi

test:
  steps:
  - script:
    name: Test
    code: |
      echo "Test Step"

security-scan:
  steps:
  - script:
    name: Security Scan
    code: |
      echo "Security Scan Step"

deploy-with-atz:
  steps:
  - script:
    name: Deploy with ATZ
    code: |
      echo "Deploy with ATZ"

dev:
  steps:
  - internal/shell

